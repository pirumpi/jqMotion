(function(e,t){e.jqMotion=function(t){var i={main:e(document),leap:{enableGestures:true}},s=e.extend({},i,t);var o=new Leap.Controller(s.leap);e(document).data({jqMotion:{jqController:o,grabbed:[],grabRelease:[]}});o.on("frame",function(e){s.main.trigger({type:"jqMotion",frame:e});if(e.gestures&&e.gestures.length){n(e.gestures,s.main)}r(e,s.main)});o.connect();return o};e.fn.jqMotion=function(t){var r=this,i=e(document).data(),o=r.data(),u={pointer:r,constrain:true,gestures:true,hand:0,container:r.parent(),trackMotion:true,action:"motion"};var a=e.extend({},u,t);var f=i.jqMotion.jqController;o.jqMotion={};o.jqMotion.grabed=[];o.jqMotion.grabRelease=[];a.container.css({position:"relative"});r.css({position:"absolute"});o.trackMotion=a.trackMotion;f.on("frame",function(e){if(e.hands.length&&e.hands[a.hand]){var t=s(e,e.hands[a.hand].palmPosition,a);if(o.trackMotion){r.css({left:Math.round(t.left)+"px",top:Math.round(t.top)+"px"})}}if(a.gestures&&e.gestures&&e.gestures.length&&e.hands.length&&e.hands[a.hand]){n(e.gestures,a.pointer)}});return r};var n=function(e,t){for(var n=0,r=e.length;n<r;n++){var i=e[n].type,s=this,o=e[n];switch(i){case"swipe":var u=o.direction;t.trigger("swipe",[o]);if(Math.abs(u[0])>Math.abs(u[1])){if(u[0]>0){t.trigger("swipeRight",[o])}else{t.trigger("swipeLeft",[o])}}else if(Math.abs(u[0])<Math.abs(u[1])){if(u[1]>0){t.trigger("swipeUp",[o])}else{t.trigger("swipeDown",[o])}}break;case"keyTap":t.trigger("keyTap",[o]);break;case"screenTap":t.trigger("screenTap",[o]);break;case"circle":t.trigger("circle",[o]);if(o.normal[2]<=0){t.trigger("circleRight",[o])}else{t.trigger("circleLeft",[o])}break;default:t.trigger(i)}}};var r=function(e,t){var n=null;if(e.hands.length){for(var r=0,s=e.hands.length;r<s;r++){if(e.hands[r].pointables.length===5){n=e.hands[r].id;if(t.data().jqMotion.grabRelease.indexOf(n)!==-1){t.data().jqMotion.grabRelease.splice(t.data().jqMotion.grabRelease.indexOf(n),1);t.trigger("grabRelease",[e])}}}if(n&&t.data().jqMotion.grabbed.indexOf(n)===-1){t.data().jqMotion.grabbed.push(n);setTimeout(function(){i(n,t)},1e3)}}};var i=function(t,n){var r=n.data().jqController;e(document).one("jqMotion",function(e){var r=e.frame.hands;if(r.length){for(var i=0,s=r.length;i<s;i++){if(r[i].id===t&&r[i].pointables.length<2){n.trigger("grab",[e]);n.data().jqMotion.grabbed.splice(n.data().jqMotion.grabbed.indexOf(t),1);n.data().jqMotion.grabRelease.push(t);return}}}n.data().jqMotion.grabbed.splice(n.data().jqMotion.grabbed.indexOf(t),1)})};var s=function(e,t,n){var r=e.interactionBox,i=r.center[0]-r.size[0]/2,s=r.center[1]+r.size[1]/2,o=t[0]-i,u=t[1]-s,a=t[2],f={width:n.container.width(),height:n.container.height(),pointerW:n.pointer.width(),pointerH:n.pointer.height()};o/=r.size[0];u/=r.size[1];o*=f.width;u*=f.height;if(n.constrain){o=o+f.pointerW>f.width?f.width-f.pointerW:o;o=o<0?0:o;u=-u<=0?0:u;u=-u+f.pointerH>f.height?-f.height+f.pointerH:u}n.pointer.trigger({type:n.action,top:-u,left:o,z:a});return{top:-u,left:o,z:a}}})(jQuery,window)